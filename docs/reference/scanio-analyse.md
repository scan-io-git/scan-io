# Analyse Command
The `analyse` command provides a top-level interface for orchestrating the execution of various security scanners. It allows users to analyze source code, dependencies, and other project files by leveraging supported scanning tools. 

orcehstarting, jobs, reports conversion, list input file 

| Supported Scanners                                         | Description                                                     |
|------------------------------------------------------------|-----------------------------------------------------------------|
| [Semgrep](https://github.com/semgrep/semgrep)              | Static analysis for security vulnerabilities and code patterns. |
| [Bandit](https://github.com/PyCQA/bandit)                  | Security linter for Python code.                                |
| [CodeQL](https://codeql.github.com/)                       | Security and quality scanning for multiple languages.           |
| [Trufflehog](https://github.com/trufflesecurity/trufflehog)| Secrets detection scanner for sensitive data exposure.          |
| [Trufflehog3](https://github.com/feeltheajf/trufflehog3)   | Secrets detection scanner for sensitive data exposure.          |


## Table of Contents

- [Syntax](#syntax)
- [Options](#options)
- [Core Validation](#core-validation)
- [Usage Examples](#usage-examples)
- [Command Output Format](#command-output-format)

## Syntax
```bash
scanio analyse --scanner/-p PLUGIN_NAME [--config/-c PATH] [--format/-f OUTPUT_FORMAT] [-j THREADS_NUMBER, default=1] {--input-file/-i PATH | PATH} -- [args...]
```

### Options
| Option           | Type    | Required    | Default Value                                                | Description                                                                 |
|-------------------|---------|-------------|--------------------------------------------------------------|-----------------------------------------------------------------------------|
| `--scanner`, `-p` | string         | Yes             | `none`                                                       | Specifies the scanner plugin to use (e.g., `semgrep`, `trufflehog`, `codeql`). |
| `--config`, `-c`  | string         | No              | `none`                                                       | Path to the scanner's configuration file. The config format depends on the specific scanner being used.     |
| `--format`, `-f`  | string         | No              | `raw`                                                        | Specifies the output format (e.g., `json`, `sarif`).                 |
| `--input-file`, `-i`  | string     | Conditional | `none`                                                        | Path to a file in [Scanio list command](cmd-list.md#command-output-format) format containing repositories to scan.      |
| `--output`, `-o`  | string     | No | ``{home_folder}/results/<VCS_domain>/  <namespace_name>/``                                                        | 	Path to save the analysis results.      |
| `--threads`, `-j`| int     | No          | `1`                                                          | Number of concurrent threads to use for parallel fetching.                   |
| `--help`, `-h`   | flag    | No          | `false`                                                      | Displays help for the `analyse` command.                                      |

**Using List Command Output as Input**<br>
The `analyse` command integrates seamlessly with the list command, allowing users to input a file generated by the `list` command for bulk code scanning. The `--input-file (-i)` flag accepts files in the format outlined in the [List Command Output Format](cmd-list.md#command-output-format).

> [!NOTE]  
> The feature is particularly useful for bulk code scanning, enabling users to scan multiple folder in a single operation efficiently.

```bash
scanio analyse --scanner semgrep --input-file /path/to/list_output.file -j 2
```


**Using List Command Output as Input**<br>
Also you are able to add additional arguments to a command. If you want to execute scanner with custom arguments, you could use two dashes (--) to separate additional flags/arguments:<br>
```scanio analyse --scanner semgrep --input-file /Users/root/.scanio/output.file --format sarif -j 1 -- --verbose --severity INFO```




Core Validation
The analyse command incorporates several layers of validation to ensure proper execution:

Scanner Availability: Ensures the scanner specified in the --scanner flag is installed and accessible.
Input Validation: Confirms that either a valid --input-file or a direct PATH is provided.
Configuration File Check: Verifies the presence of a valid scanner configuration if the --config flag is used.
Concurrency Handling: Ensures thread count does not exceed





## Using Scenarios 
When developing, we aimed at the fact that the program will be used primarily for automation purposes but you still able to use it manually from CLI.

### Analysing from an Input File
The command uses an output format of a List command for analysing required repositories.<br>

If you use an **input file** argument the command will save results into a home directory - ```~/.scanio/results/+<VCSURL>+<Namespace>+<repo_name>/<scanner_name>.<report_format>```.<br>
You can redifine a home directory by using **SCANIO_HOME** environment variable.

#### Semgrep
* Analysing using semgrep with an input file argument.<br>
```scanio analyse --scanner semgrep --input-file /Users/root/.scanio/output.file --format sarif -j 2```
* Analysing using semgrep with a specific path .<br>
```scanio analyse --scanner semgrep --format sarif -j 1 /tmp/my_project```
* Analysing using semgrep with an input file and custom rules.<br>
```scanio analyse --scanner semgrep --config /Users/root/scan-io-semgrep-rules --input-file /Users/root/.scanio/output.file --format sarif -j 2```
* Analysing using semgrep with an input file and additional arguments.<br>
```scanio analyse --scanner semgrep --input-file /Users/root/.scanio/output.file --format sarif -- --verbose --severity INFO```

#### Bandit
* Analysing from an input file.<br>
```scanio analyse --scanner bandit --input-file /Users/root/.scanio/output.file```

### Analysing only one repository manually by path
The command uses a path that is pointing to a particular folder for analysing.<br>

If you use a specific **path** argument the command will save results into the same directory:<br>
* ```scanio analyse --scanner <scanner_name> --format sarif /tmp/my_project```
> Result path - ```/tmp/my_project/<scanner_name>.<report_format>```

#### Semgrep
```scanio analyse --scanner semgrep --format sarif /tmp/my_project```

#### Bandit
*TODO*
