# Analyse Command
The `analyse` command provides an orchestration layer for running scanners within Scanio. It enables users to execute specific security scanners against codebase or repositories with customizable configuration, output formats, and parallel execution.

This command supports running a scanner against a specific folder or in bulk using the output of the `list` command.

| Supported Scanners                                         | Description                                                     |
|------------------------------------------------------------|-----------------------------------------------------------------|
| [Semgrep](https://github.com/semgrep/semgrep)              | Static analysis for security vulnerabilities and code patterns. |
| [Bandit](https://github.com/PyCQA/bandit)                  | Security linter for Python code.                                |
| [CodeQL](https://codeql.github.com/)                       | Security and quality scanning for multiple languages.           |
| [Trufflehog](https://github.com/trufflesecurity/trufflehog)| Secrets detection scanner for sensitive data exposure.          |
| [Trufflehog3](https://github.com/feeltheajf/trufflehog3)   | Secrets detection scanner for sensitive data exposure.          |

## Table of Contents
- [Supported Actions](#supported-actions)
- [Syntax](#syntax)
- [Options](#options)
- [Usage Examples](#usage-examples)
- [Additional Scanner Arguments](#additional-scanner-arguments)
- [Command Output Format](#command-output-format)

## Supported Actions
| Action                                      | Description                       |
|---------------------------------------------|-----------------------------------|
| Run scanner against a specific directory    | Analyse a single local project    |
| Run scanner against multiple repositories   | Use `list` command output         |

## Syntax
```bash
scanio analyse --scanner/-p PLUGIN_NAME [--config/-c PATH] [--format/-f OUTPUT_FORMAT] [-j THREADS_NUMBER, default=1] {--input-file/-i PATH | PATH} -- [args...]
```

### Options
| Option           | Type    | Required    | Default Value                                                | Description                                                                 |
|-------------------|---------|-------------|--------------------------------------------------------------|-----------------------------------------------------------------------------|
| `--scanner`, `-p` | string         | Yes             | `none`                                                       | Specifies the scanner plugin to use (e.g., `semgrep`, `trufflehog`, `codeql`). |
| `--config`, `-c`  | string         | No              | `none`                                                       | Path to the scanner's configuration file. The config format depends on the specific scanner being used.     |
| `--format`, `-f`  | string         | No              | `raw`                                                        | Specifies the output format (e.g., `json`, `sarif`).                 |
| `--input-file`, `-i`  | string     | Conditional | `none`                                                        | Path to a file in [Scanio list command](cmd-list.md#command-output-format) format containing repositories to scan.      |
| `--output`, `-o`  | string     | No | ``{home_folder}/results/<VCS_domain>/  <namespace_name>/``                                                        | 	Path to save the analysis results.      |
| `--threads`, `-j`| int     | No          | `1`                                                          | Number of concurrent threads to use for parallel fetching.                   |
| `--help`, `-h`   | flag    | No          | `false`                                                      | Displays help for the `analyse` command.                                      |

**Using List Command Output as Input**<br>
The `analyse` command integrates seamlessly with the list command, allowing users to input a file generated by the `list` command for bulk code scanning. The `--input-file (-i)` flag accepts files in the format outlined in the [List Command Output Format](cmd-list.md#command-output-format).

> [!NOTE]  
> The feature is particularly useful for bulk code scanning, enabling users to scan multiple folder in a single operation efficiently.

```bash
scanio analyse --scanner semgrep --input-file /path/to/list_output.file -j 2
```

**Using List Command Output as Input**<br>
Also you are able to add additional arguments to a command. If you want to execute scanner with custom arguments, you could use two dashes (--) to separate additional flags/arguments:<br>
```scanio analyse --scanner semgrep --input-file /Users/root/.scanio/output.file --format sarif -j 1 -- --verbose --severity INFO```

**Additional Scanner Argument**<br>
You can add extra arguments directly to the scanner call by using two dashes (`--`). These additional arguments will be passed directly to the underlying scanner without being processed by Scanio itself.

This is useful for passing scanner-specific flags, filters, or configuration values.

```bash
scanio analyse --scanner semgrep --input-file /path/to/list_output.file --format sarif -j 1 -- --verbose --severity INFO
```

### Core Validation
The `fetch` command includes several validation layers to ensure robust execution and accurate results:
- **Flag Requirements**: Ensures all required flags and parameters, as defined in the [Options](#options) table, are provided.
- **VCS Plugin Availability**: Validates the `--scanner/-p` flag against available plugins in the `plugins` directory. Only plugins with the type `scanner` are considered valid.
- **Configuration File Check**: Verifies the presence of a valid scanner configuration if the --config flag is used.
- **Input Validation**: Confirms that either an `--input-file` or a path is provided. Both cannot be omitted simultaneously.

## Usage Examples
The following examples demonstrate how to use the `analyse` command for different plugins. Each example covers specific use cases, such as scaning singe or brach code folders, using convertion for custom report formats, and managing parallel jobs.

Refer to plugin-specific documentation for detailed examples and additional requirements of the command usage:
- [Semgrep Plugin](plugin-semgrep.md)
- [Trufflehog Plugin]()
- [CodeQL Plugin]()
- [Bandit Plugin]()
- [Trufflehog3 Plugin]()

### Output Structure
```json
{
    "launches": [
        {
            "args": {
                "target_path": "<path_to_folder_with_code>",
                "results_path": "<path_to_report_file>",
                "config_path": "<path_to_config_file/folder>",
                "report_path": "<report_format>",
                "additional_args": [
                    "<additional_arg>"
                ]
            },
            "result": {
                "results_path": "<path_to_report_file>"
            },
            "status": "<status>",
            "message": "<error_message>"
        }
    ]
}
```

### Key Fields
| Field       | Description                                                                   |
|-------------|-------------------------------------------------------------------------------|
| `launches`  | List of scanner executions performed during the run.                          |
| `args`      | Dictionary containing the arguments used to execute the command.              |
| `result`    | List of dictionaries representing the actual command results.                 |
| `status`    | String indicating the final status of the command (e.g., `OK`, `FAILED`).     |
| `message`   | String containing error messages or `stderr` output if the status is not `OK`.|


### Fields in the `args` Object

| Field              | Description                                                   |
|--------------------|---------------------------------------------------------------|
| `args`             | Arguments used to execute the scanner.                        |
| `target_path`      | Path to the codebase scanned.                                 |
| `config_path`      | Path to the scanner configuration used.                       |
| `report_path`      | Output format of the report (e.g., JSON, SARIF).              |
| `additional_args`  | Any extra arguments passed to the scanner.                    |

### Fields in the `result` List
| Field              | Description                                                                 |
|--------------------|-----------------------------------------------------------------------------|
| `results_path`     | Path to the generated report file.                                          |
